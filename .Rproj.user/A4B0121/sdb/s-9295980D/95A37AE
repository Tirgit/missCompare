{
    "collab_server" : "",
    "contents" : "install.packages(\"devtools\")\nlibrary(\"devtools\")\ndevtools::install_github(\"klutometis/roxygen\")\nlibrary(roxygen2)\n\n###PACKAGES\nlibrary(mice)\nlibrary(VIM)\nlibrary(ggplot2)\nlibrary(magrittr)\nlibrary(dplyr)\nlibrary(MASS)\nlibrary(Matrix)\nlibrary(missForest)\nlibrary(missMDA)\nlibrary(pcaMethods)\nlibrary(mi)\nlibrary(Amelia)\nlibrary(tidyr)\nlibrary(pROC)\nlibrary(ROCR)  \nlibrary(Hmisc)\nlibrary(ggdendro)\nlibrary(mlbench)\n\n###FUNCTIONS\nsetwd(\"/Users/med-tv_/Documents/GitHub/missingdata\")\nsource(\"dimple_clean.R\")\nsource(\"dimple_get_data.R\")\nsource(\"dimple_sim.R\")\nsource(\"dimple_MCAR.R\")\nsource(\"dimple_MAR.R\")\nsource(\"dimple_MNAR.R\")\nsource(\"dimple_MAP.R\")\nsource(\"dimple_all_patterns.R\")\n#source(\"dimple_predict_missing.R\")\n\nsource(\"dimple_random_imp.R\")\nsource(\"dimple_median_imp.R\")\nsource(\"dimple_mean_imp.R\")\nsource(\"dimple_missMDA_EM_imp.R\")\nsource(\"dimple_missMDA_regularized_imp.R\")\nsource(\"dimple_pcaMethods_svdImpute_imp.R\")\nsource(\"dimple_pcaMethods_PPCA_imp.R\")\nsource(\"dimple_pcaMethods_NLPCA_imp.R\")\nsource(\"dimple_pcaMethods_Nipals_imp.R\")\nsource(\"dimple_pcaMethods_BPCA_imp.R\")\nsource(\"dimple_mi_imp.R\")\nsource(\"dimple_mice_mixed_imp.R\")\nsource(\"dimple_missForest_imp.R\")\nsource(\"dimple_AmeliaII_imp.R\")\nsource(\"dimple_aregImpute_imp.R\")\nsource(\"dimple_kNN_imp.R\")\n\nsource(\"dimple_imp_wrapper.R\")\nsource(\"dimple_summary.R\")\n\n\n###LAB\ndata(\"BostonHousing\")\ndf <- BostonHousing\ndf_miss <- prodNA(df, 0.1)\n\ny <- dimple_get_data(df_miss, matrixplot_sort = T)\n\ncleaned <- dimple_clean(df_miss)\n\ny <- dimple_get_data(cleaned$Dataframe_clean, matrixplot_sort = T)\n\nyy <- dimple_sim(rownum = y$Rows, colnum = y$Columns, cormat = y$Corr_matrix)\n\nres <- dimple_MCAR(yy$Simulated_matrix, y$Fraction_missingness_per_variable)\nres <- dimple_MNAR(yy$Simulated_matrix, y$Fraction_missingness_per_variable)\nres <- dimple_MAR(yy$Simulated_matrix, y$Fraction_missingness_per_variable)\nres <- dimple_MAP(yy$Simulated_matrix, y$Fraction_missingness_per_variable, \n                  assumed_pattern = c(rep(\"MAR\", 6),rep(\"MCAR\", 4),rep(\"MNAR\", 4)))\n\nres <- dimple_all_patterns(yy$Simulated_matrix, y$Fraction_missingness_per_variable, \n                           assumed_pattern = c(rep(\"MAR\", 6),rep(\"MCAR\", 4),rep(\"MNAR\", 4)))\n\nmatrixplot(res$MCAR_matrix, interactive = F, col= \"red\") \nmatrixplot(res$MAR_matrix, interactive = F, col= \"red\") \nmatrixplot(res$MNAR_matrix, interactive = F, col= \"red\") \nmatrixplot(res$MAP_matrix, interactive = F, col= \"red\") \n\n\ndimple_median_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_mean_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_missMDA_regularized_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_missMDA_EM_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_pcaMethods_PPCA_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_pcaMethods_svdImpute_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_pcaMethods_BPCA_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_pcaMethods_Nipals_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_pcaMethods_NLPCA_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_mice_mixed_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_mi_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_AmeliaII_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_missForest_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_aregImpute_imp(X_hat = yy$Simulated_matrix, list = res)\ndimple_kNN_imp(X_hat = yy$Simulated_matrix, list = res)\n\n\nwrap <- dimple_imp_wrapper(rownum = y$Rows, \n                           colnum = y$Columns, \n                           cormat = y$Corr_matrix, \n                           missfrac_per_var =  y$Fraction_missingness_per_variable, \n                           n.iter = 5)\n\n\n\nwraps <- readRDS(file = \"/Users/med-tv_/Documents/Projects/missingdata/wraps.rds\")\n\nImputation_RMSE <- rbind(wraps, wrap$Imputation_RMSE)\n\nsaveRDS(Imputation_RMSE, file = \"/Users/med-tv_/Documents/Projects/missingdata/wraps.rds\")\n\n\nforgraph <- gather(Imputation_RMSE, Pattern, RMSE, MCAR_RMSE:MNAR_RMSE, factor_key=TRUE)\nforgraph$Method <- factor(forgraph$Method, levels = c(\"Random replacement\", \"Median imputation\", \"Mean imputation\", \"missMDA Regularized\", \n                                                      \"missMDA EM\", \"pcaMethods PPCA\", \"pcaMethods svdImpute\", \"pcaMethods BPCA\", \n                                                      \"pcaMethods NIPALS\", \"pcaMethods NLPCA\", \"mice mixed\",\n                                                      \"mi Bayesian\", \"Amelia II\", \"missForest\"))\nlevels(forgraph$Pattern) <- c(\"MCAR\", \"MAR\", \"MNAR\")\np <- ggplot(forgraph, aes(x=Method, y=RMSE, fill=Method)) + \n  geom_boxplot() +\n  facet_grid(~Pattern, scale=\"free\") + \n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + \n  ggtitle(\"Root-mean-square error (RMSE) of various missing data imputation methods\") +\n  theme(plot.title = element_text(hjust = 0.5)) +\n  labs(x=\"\") \n\n\n\n\npdf(\"/Users/med-tv_/Documents/Projects/missingdata/RMSE_plot.pdf\", width=10, height=6)\np\ndev.off()\n\n\ndimple_summary(wrap)\n\n\n\n\n\n\n\n\n\n#REAL DATA\nlibrary(foreign)\nmydata <- read.dta(\"/Volumes/External/LOCUS/pheno/glacier_corr_160127.dta\")\nvars <- colnames(mydata)\nto_exclude <- c(grep(\"da\", names(mydata), value=TRUE) ,\n                grep(\"gram\", names(mydata), value=TRUE),\n                grep(\"sum\", names(mydata), value=TRUE),\n                grep(\"upps\", names(mydata), value=TRUE),\n                grep(\"delp\", names(mydata), value=TRUE)\n                )\nmydata <- mydata[, !(names(mydata) %in% to_exclude )] \nmydata <- mydata[mydata$besok == 1,]\nmydata <- mydata[!is.na(mydata$id),]\nmydata <- mydata[1:2000, 2:16]\n\n\n\ny <- dimple_get_data(mydata, matrixplot_sort = T, plot_transform = T)\ny$Matrix_plot\nclean <- dimple_clean(mydata, var_removal_threshold = 0.4)\ny <- dimple_get_data(clean$Dataframe_clean, matrixplot_sort = T)\ny$Matrix_plot\ny$Cluster_plot\n\nyy <- dimple_sim(rownum = y$Rows, colnum = y$Columns, cormat = y$Corr_matrix)\n\n\nn <- naclus(clean$Dataframe_clean)\nplot(n)\n\nwrap <- dimple_imp_wrapper(rownum = y$Rows, \n                           colnum = y$Columns, \n                           cormat = y$Corr_matrix, \n                           missfrac_per_var =  y$Fraction_missingness_per_variable, \n                           n.iter = 5)\ndimple_summary(wrap)\n\n\n\n\n\nas.data.frame(scale(mydata))\n\n\n#visualizing MAR/MNAR on matrixplot\nMNAR_spike <- res$MNAR_matrix\ncolnames(MNAR_spike) <- c(\"X1\", \"X2\",\"X3\",\"X4\",\"X5\",\"X6\",\"X7\",\"X8\",\"X9\",\"X10\")\nnm1 <- colnames(MNAR_spike)[colSums(is.na(MNAR_spike)) >0]\narr_MNAR_spike <- MNAR_spike %>% \n  as.data.frame() %>% \n  arrange_at(vars(nm1), funs(desc(is.na(.))))\nmatrixplot(arr_MNAR_spike, interactive = F, col= \"red\")\n\n\n\nzzz <- sink(dimple_missForest_imp(X_hat = yy$Simulated_matrix, list = res))\n\nhush <- function(code){\n  sink(\"NUL\") # use /dev/null in UNIX\n  tmp = code\n  sink()\n  return(tmp)\n}\n\n\nzzz <- as.data.frame(res$MCAR_matrix)\nzzzcolnames <- colnames(zzz)\n\nresu <- kNN(data = zzz, variable = zzzcolnames, k=6, trace = F, imp_var = F)\n?kNN\n\n",
    "created" : 1525180851982.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2244409885",
    "id" : "95A37AE",
    "lastKnownWriteTime" : 1525180378,
    "last_content_update" : 1525180378,
    "path" : "~/Documents/GitHub/missingdata/dimple/R/dimple_flow.R",
    "project_path" : "dimple/R/dimple_flow.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}